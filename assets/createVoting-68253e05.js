import"./main-827c712b.js";import{a as v}from"./axios-3a76d256.js";const I="https://teatimeapi-test.onrender.com",y=new autoComplete({selector:"#navSearchAutoComplete",data:{src:async t=>{try{return await(await fetch(`${I}/restaurants`)).json()}catch(e){return e}},keys:["storeName"]},searchEngine:"loose",resultItem:{highlight:!0},resultsList:{element:(t,e)=>{if(!e.results.length){const n=document.createElement("div");n.setAttribute("class","no_result px-8"),n.innerHTML=`<span>Found No Results for "${e.query}"</span>`,t.prepend(n)}},noResults:!0},events:{input:{selection:t=>{const e=t.detail.selection.value;y.input.value=e.storeName,console.log(e.storeName),window.location.href=`./store-order.html?UID=${e.UID}`},keydown:t=>{t.keyCode===13&&(y.input.value,console.log(selectionValue.storeName),window.location.href=`./store-order.html?UID=${selectionValue.UID}`)}}}}),b=document.querySelector(".needs-validation"),E=document.querySelector(".inputLoginAccount"),x=document.querySelector(".inputLoginPassword"),T=document.querySelectorAll(".btnLoginSubmit"),k=document.querySelectorAll(".btnLogin"),D=document.querySelectorAll(".btnUserLoggedIn"),f=document.querySelectorAll(".btnLogOut");T.forEach(t=>{t.addEventListener("click",()=>{const e=E.value,n=x.value;if(b.checkValidity()||b.classList.add("was-validated"),e==="ling-huang@fat-together.com"&&n==="ling-huang")f.forEach(o=>{o.classList.remove("d-none")}),D.forEach(o=>{o.classList.remove("d-none")}),k.forEach(o=>{o.classList.add("d-none")}),$("#accountModal").modal("hide");else{const o=document.querySelector(".invalid-feedback");o.style.display="block"}})});f.forEach(t=>{t.addEventListener("click",()=>{f.forEach(e=>{e.classList.add("d-none")}),D.forEach(e=>{e.classList.add("d-none")}),k.forEach(e=>{e.classList.remove("d-none")})})});const l="https://teatimeapi-test.onrender.com";moment().format("YYYY/MM/DD");let i={category:"全部",sort:"",search:""};const q={newestStore:"&_sort=id&_order=desc",bestStore:"&_sort=stars&_order=desc",worstStore:"&_sort=stars&_order=asc"};function L(t,e,n){let o="",s="",a="";t!=="全部"&&t&&(o=`category=${t}`),e&&(s=e),n&&(a=`&storeName_like=${n}`);let c=`${l}/restaurants?${o}${s}${a}`;U(c)}L();const N=document.querySelectorAll(".btnSortStore");N.forEach(t=>{t.addEventListener("click",function(){const e=this.getAttribute("data-sort-value");d("sort",e)})});const A=document.querySelectorAll(".btnCategoryStore");A.forEach(t=>{t.addEventListener("click",function(){const e=this.getAttribute("data-category-value");d("category",e)})});function d(t,e){switch(t){case"category":i[t]=e;break;case"search":i[t]=e.trim();break;default:i[t]=q[e];break}L(i.category,i.sort,i.search)}function U(t){$(function(){(function(e){let n=$("#pagination"+e);$.ajax({url:t,success:function(o){V(o,n)},error:function(o){console.error(o)}})})("Pages")})}function V(t,e){e.pagination({dataSource:t,totalNumber:t.length,pageSize:8,showPageNumbers:!0,showPrevious:!0,showNext:!0,callback:function(n,o){j(n),P()}})}function j(t){const e={飲料:"icon-park-outline:drink",速食:"mdi:food-outline",素食:"tabler:leaf",小吃:"ph:bowl-food",甜點:"material-symbols:icecream-outline-rounded",咖啡:"icon-park-outline:tea-drink"};let n='<ul class="row row-cols-2 gap-12 gap-xxl-24 findStore-ul">';$.each(t,function(o,s){const a=r.hasOwnProperty(s.UID);n+=`<li class="findStore-img position-relative" style="background-image: url(${s.storeCover});"> 
                        <!-- select-store-checkbox --> 
                        <label class="select-store">
                            <input type="checkbox" class="position-absolute select-store-checkbox" name="selectStoreCheck${s.UID}" data-uid="${s.UID}" ${a?"checked":""}>
                            <span class="position-absolute cursor-pointer select-store-checkmark"></span></label>
                            <a href="store-order.html?UID=${s.UID}" class="d-flex justify-content-center w-100 h-100 ">
                                <!-- restaurant info -->
                                <div class="position-absolute d-flex justify-content-between findStore-card">
                                    <div class="d-flex flex-column justify-content-center overflow-hidden">
                                        <p class="mb-8 fs-md-20 fs-16 lh-sm text-white" style="white-space:nowrap">${s.storeName}</p>
                                        <!-- 星評 -->
                                        <div class="d-flex ">
                                            ${M(s.stars)}
                                        </div>
                                    </div>
                                    <!-- restaurant sort -->
                                    <iconify-icon icon="${e[s.category]}"
                                        style="color: #8b8b8a;" width="24" height="24"
                                        class="ms-4 findStore-card-img"></iconify-icon>
                                </div>
                            </a>
                        </li>`}),n+="</ul>",$("#paginationContainer").html(n)}function M(t){const n={isGoodStar:`<iconify-icon icon="ic:round-star" style="color: #ffd43a;"
                                                width="16"></iconify-icon>`,notGoodStar:`<iconify-icon icon="ic:round-star" style="color: #c2c1bd;"
                                                width="16"></iconify-icon>`};return n.isGoodStar.repeat(t)+n.notGoodStar.repeat(5-t)}const r={};function P(){const t=document.querySelectorAll("input[type='checkbox']"),e=3;t.forEach(n=>{n.addEventListener("change",function(){const o=this.getAttribute("data-uid"),s=r.hasOwnProperty(o);Object.keys(r).length===e&&!s?this.checked=!1:s?(delete r[o],g()):v.get(`${l}/restaurants?UID=${o}`).then(function(c){r[o]=_(c.data[0]),g()}).catch(c=>{console.log("錯誤:",c)})})})}function _(t){return{UID:t.UID,restaurantId:t.id,restaurantName:t.storeName,restaurantCover:t.storeCover,summary:t.summary,minGroupSize:t.minGroupSize}}function Y(){const t=document.querySelector(".checkedStoreContainer");Object.keys(r).length>0?t.classList.remove("d-none"):t.classList.add("d-none")}function g(){const t=document.querySelector(".showCheckedList");let e="";Object.values(r).forEach(n=>{e+=`<li class="d-flex align-items-center py-10 px-20 py-md-12 px-md-24 gap-8 rounded-pill bg-gray-04">
                                <span class="fs-12 fs-md-16 fw-medium">${n.restaurantName}</span>
                                <button type="button" class="btn-close cancelCheckedStore" data-uid=${n.UID}></button>
                            </li>`}),t.innerHTML=e,B(),Y(),H()}function B(){document.querySelectorAll(".cancelCheckedStore").forEach(e=>{e.addEventListener("click",function(){const n=this.getAttribute("data-uid");console.log(n);const o=document.querySelector(`input[data-uid=${n}]`);o.checked=!1,delete r[n],console.log(r),g()})})}function H(){const t=document.querySelector(".checkCheckedStoreAbove"),e=document.querySelector(".checkCheckedStoreBelow");Object.keys(r).length>1?(t.classList.add("d-sm-block"),e.classList.remove("d-none"),e.classList.add("d-block","d-sm-none")):(t.classList.remove("d-sm-block"),e.classList.add("d-none"))}const w=document.getElementById("modal-createVoting"),O=w.querySelector(".modal-title"),u=document.getElementById("eventDateTime"),m=document.getElementById("deadlineDateTime"),p=document.getElementById("votingInvitees"),F=document.querySelector(".votingCard"),G=document.querySelector(".btnCreateVoting");w.addEventListener("show.bs.modal",function(t){const e=Object.values(r);z(e),R(e)});function z(t){const e=t.map(h=>h.restaurantName);O.textContent=e.join("、");const n=u._flatpickr,o=m._flatpickr,s=sessionStorage.getItem("eventDateTime"),a=sessionStorage.getItem("deadlineDateTime"),c=sessionStorage.getItem("votingInvitees");n.setDate(s,!0),o.setDate(a,!0),p.value=c}function R(t){let e="";t.forEach(n=>{e+=`
                            <li class="d-flex gap-12 p-12 mb-12 border border-brand-03 border-radius-40401616">
                                <img class="border-radius-32321616 votingcard-photo" src="${n.restaurantCover}">
                                <div>
                                <h4 class="mb-8 fs-16 fs-md-20 lh-sm text-brand-03">${n.restaurantName}</h4>
                                <p class="mb-8 mb-md-16 text-gray-02 trippleline-ellipsis">${n.summary}</p>
                                <div>
                                <span class="me-16 text-gray-02 text-nowrap">成團目標</span>
                                <span class="text-gray-02">${n.minGroupSize} 人</span>
                                </div>                                 
                            </li>`}),F.innerHTML=e}G.addEventListener("click",J);async function J(){if(X()){$("#modal-createdSuccess").modal("hide"),$("#modal-createVoting").modal("show");return}try{const e=await K();Q(e),$("#modal-createdSuccess").modal("show")}catch(e){console.log("錯誤:",e)}}async function K(){try{const e=(await v.get(`${l}/votings`)).data,o=e[e.length-1].UID.match(/(\D+)(\d+)/);if(o){const s=o[1];let a=parseInt(o[2]);return a++,s+a.toString().padStart(o[2].length,"0")}}catch(t){throw console.log("錯誤:",t),t}}function Q(t){const e=Object.values(r),n=[];e.forEach(o=>{const s={...o};delete s.restaurantCover,delete s.summary,delete s.minGroupSize,s.UID=t,s.deadlineDateTime=m.value,s.eventDateTime=u.value,s.initiator="黃莉玲",s.invitees=p.value==="has-invitees"?"黃莉玲":"",s.currentVoters=[],n.push(s)}),W(n)}function W(t){let e=0;function n(o){v.post(`${l}/votings`,o).then(function(s){e++,e<t.length&&n(t[e]),console.log("success")}).catch(s=>{console.log("錯誤:",s)})}n(t[e])}function X(){let t=!1;const e=document.querySelector(".eventDateTimeAlert"),n=document.querySelector(".deadlineDateTimeAlert"),o=document.querySelector(".votingInviteesAlert");let s="",a="";const c=document.getElementById("eventDateTime").value.trim(),h=document.getElementById("deadlineDateTime").value.trim();return c&&(s=moment(u.value,"YYYY/MM/DD HH:mm")),h&&(a=moment(m.value,"YYYY/MM/DD HH:mm")),s===""?(e.classList.remove("d-none"),t=!0):e.classList.add("d-none"),a===""?(n.classList.remove("d-none"),n.textContent="必填",t=!0):n.classList.add("d-none"),p.value===""?(o.classList.remove("d-none"),t=!0):o.classList.add("d-none"),s&&a&&(s.diff(a,"hours")<24?(n.classList.remove("d-none"),n.textContent="截止時間須至少提前於享用日期 24 時",t=!0):n.classList.add("d-none")),t}const C=document.getElementById("modal-createdSuccess");C.addEventListener("show.bs.modal",function(t){const e=u.value,n=m.value;document.querySelector(".eventDateTime-Date").textContent=e.substring(5,10),document.querySelector(".eventDateTime-Time").textContent=e.split(" ")[1],document.querySelector(".deadlineDateTime-Date").textContent=n.substring(5,10),document.querySelector(".deadlineDateTime-Time").textContent=n.split(" ")[1]});C.addEventListener("show.bs.modal",function(t){document.querySelector(".btnLinkToCalendar").addEventListener("click",function(){window.location.href="./calendar.html"})});const S=new autoComplete({data:{src:async t=>{try{return await(await fetch(`${l}/restaurants`)).json()}catch(e){return e}},keys:["storeName"]},searchEngine:"loose",resultItem:{highlight:!0},resultsList:{element:(t,e)=>{if(!e.results.length){const n=document.createElement("div");n.setAttribute("class","no_result px-8"),n.innerHTML=`<span>Found No Results for "${e.query}"</span>`,t.prepend(n)}},noResults:!0},events:{input:{selection:t=>{const e=t.detail.selection.value;S.input.value=e.storeName,console.log(e),d("search",e.storeName)},keydown:t=>{if(t.keyCode===13){const e=S.input.value;console.log(`這是 ${e}`),d("search",e)}}}}});
